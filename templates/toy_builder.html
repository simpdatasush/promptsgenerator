<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Toy Builder | SuperPrompter</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <style>
        /* Essential styles included here in case style.css is cached */
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .brick { 
            padding: 15px 25px; background: #fff; border: 2px solid #e0e0e0; 
            border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s;
        }
        .brick.active { border-color: #007bff; background: #f0f7ff; transform: scale(1.05); }
        .brick-fly { position: fixed; z-index: 9999; background: #007bff !important; color: white !important; border-radius: 50px !important; pointer-events: none; }
        .minimal-search-box { 
            background: #fff; border: 1px solid #e0e0e0; border-radius: 50px; 
            padding: 10px 25px; display: flex; align-items: center; max-width: 700px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .minimal-search-box input { border: none; outline: none; width: 100%; font-size: 1.2rem; }
        .minimal-search-box button { background: #000; color: #fff; border: none; border-radius: 50%; width: 45px; height: 45px; }
        #response-area { white-space: pre-wrap; line-height: 1.6; color: #2c3e50; }
    </style>
</head>
<body>

<header class="app-header">
        <div class="logo-section">
            <img src="https://placehold.co/40x40/007bff/ffffff?text=AI" alt="SuperPrompter Logo" class="app-logo">
            <h1 class="header-title">SuperPrompter</h1>
        </div>
        <div class="auth-section">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('toy_builder') }}" class="btn btn-outline-light btn-sm mr-2"><i class="fas fa-puzzle-piece"></i> AI Toy Box</a>
                <a href="{{ url_for('app_home') }}" class="btn btn-outline-light btn-sm mr-2">App Home</a>
                <a href="{{ url_for('llm_benchmark') }}" class="btn btn-outline-light btn-sm mr-2">LLM Benchmarks</a>
                <span class="navbar-text mr-2">Logged in as: <strong>{{ current_user.username }}</strong></span>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Logout</a>
            {% else %}
                <a href="{{ url_for('toy_builder') }}" class="btn btn-outline-light btn-sm mr-2"><i class="fas fa-puzzle-piece"></i> AI Toy Box</a>
                <a href="{{ url_for('llm_benchmark') }}" class="btn btn-outline-light btn-sm mr-2">LLM Benchmarks</a>
                <a href="{{ url_for('login') }}" class="btn btn-outline-light btn-sm mr-2">Login</a>
                <a href="{{ url_for('register') }}" class="btn btn-light btn-sm">Register</a>
            {% endif %}
        </div>
    </header>

<div class="container mt-5">
    <div id="builder-phase" class="text-center">
        <h1 class="header-title mb-2" style="font-weight:700; letter-spacing:-1px;">SuperPrompter Toy Box</h1>
        <p class="text-muted mb-5">Select your bricks to build a custom AI toy.</p>
        
        <div class="lego-container">
            <h5 class="mb-3">Choose a Brain</h5>
            <div class="d-flex justify-content-center gap-3 mb-4">
                <div class="brick" onclick="selectBrick(this, 'brain', 'Space Pirate')">üè¥‚Äç‚ò†Ô∏è Pirate</div>
                <div class="brick" onclick="selectBrick(this, 'brain', 'Mad Scientist')">üß™ Scientist</div>
                <div class="brick" onclick="selectBrick(this, 'brain', 'Zen Master')">üßò Zen</div>
            </div>

            <h5 class="mb-3">Choose a Vibe</h5>
            <div class="d-flex justify-content-center gap-3">
                <div class="brick" onclick="selectBrick(this, 'vibe', 'Sarcastic')">üòè Sarcastic</div>
                <div class="brick" onclick="selectBrick(this, 'vibe', 'Hyper Excited')">ü§© Excited</div>
                <div class="brick" onclick="selectBrick(this, 'vibe', 'Grumpy')">üò† Grumpy</div>
            </div>
        </div>

        <button id="ignite-btn" class="btn btn-primary btn-lg mt-5" onclick="ignite()" style="border-radius:30px; padding: 12px 40px;">Ignite Toy</button>
    </div>

    <div id="chat-phase" style="display:none;" class="text-center">
        <div class="d-flex justify-content-between align-items-center mb-5 mx-auto" style="max-width:700px;">
            <h2 class="m-0" style="font-weight:700;">Where should we begin?</h2>
            <button class="btn btn-outline-secondary btn-sm" onclick="disassemble()" style="border-radius:20px;">
                <i class="fas fa-undo"></i> Reset Bricks
            </button>
        </div>

        <div class="minimal-search-box">
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button onclick="sendToGemma()"><i class="fas fa-arrow-up"></i></button>
        </div>
        <div id="response-area" class="mt-4 text-left mx-auto p-4" style="max-width:700px; background: white; border-radius: 15px;"></div>
    </div>
</div>

<script>
let assembly = { brain: '', vibe: '' };

function selectBrick(el, type, val) {
    el.parentElement.querySelectorAll('.brick').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
    assembly[type] = val;
}

function ignite() {
    if(!assembly.brain || !assembly.vibe) return alert("Select a Brain and Vibe first!");

    const activeBricks = document.querySelectorAll('.brick.active');
    
    // Temporarily show chat phase to get the position for animation
    const chatPhase = document.getElementById('chat-phase');
    chatPhase.style.display = 'block';
    chatPhase.style.visibility = 'hidden';
    const target = document.querySelector('.minimal-search-box');
    const targetRect = target.getBoundingClientRect();
    chatPhase.style.display = 'none';
    chatPhase.style.visibility = 'visible';

    activeBricks.forEach(brick => {
        const rect = brick.getBoundingClientRect();
        const flyer = brick.cloneNode(true);
        flyer.classList.add('brick-fly');
        flyer.style.top = rect.top + 'px';
        flyer.style.left = rect.left + 'px';
        flyer.style.width = rect.width + 'px';
        document.body.appendChild(flyer);

        setTimeout(() => {
            flyer.style.transition = "all 0.8s cubic-bezier(0.7, 0, 0.3, 1)";
            flyer.style.top = targetRect.top + 'px';
            flyer.style.left = (targetRect.left + (targetRect.width / 2) - (rect.width / 2)) + 'px';
            flyer.style.opacity = '0';
            flyer.style.transform = 'scale(0.2)';
        }, 50);
        setTimeout(() => flyer.remove(), 800);
    });

    fetch('/ignite_toy', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(assembly)
    }).then(() => {
        setTimeout(() => {
            document.getElementById('builder-phase').style.display = 'none';
            document.getElementById('chat-phase').style.display = 'block';
        }, 600);
    });
}

function disassemble() {
    fetch('/reset_toy', {method: 'POST'}).then(() => {
        location.reload();
    });
}

function sendToGemma() {
    const input = document.getElementById('chat-input');
    const output = document.getElementById('response-area');
    const msg = input.value;
    if (!msg) return;

    output.innerHTML = "<em class='text-muted'>Toy is thinking...</em>";
    
    fetch('/chat_toy', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: msg})
    })
    .then(res => res.json())
    .then(data => {
        output.innerHTML = "";
        typeWriter(data.reply, 0);
        input.value = '';
    })
    .catch(err => {
        output.innerText = "Error: My gears are jammed!";
    });
}

function typeWriter(text, i) {
    const output = document.getElementById("response-area");
    if (i < text.length) {
        output.innerText = text.substring(0, i + 1);
        setTimeout(() => typeWriter(text, i + 1), 15);
    }
}
</script>

</body>
</html>
