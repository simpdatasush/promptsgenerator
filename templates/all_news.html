<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Latest AI News - SuperPrompter AI</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<style>
/* Reusing styles from previous pages */
:root {
--color-primary: #C3497C;
--color-secondary: #5CA0DC;
--color-dark-bg: #311B92;
--color-text-dark: #2c3e50;
--color-text-muted: #777;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding-top: 70px;
background-color: #f8f9fa;
color: var(--color-text-dark);
line-height: 1.6;
}
.app-header {
background-color: var(--color-dark-bg);
color: #ffffff;
padding: 15px 30px;
display: flex;
justify-content: space-between;
align-items: center;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
width: 100%;
position: fixed;
top: 0;
left: 0;
z-index: 1000;
}
.logo-section a {
color: #fff;
text-decoration: none;
font-size: 1.5rem;
font-weight: 600;
}
.article-card {
border: 1px solid #dee2e6;
border-left: 5px solid var(--color-primary); /* Pink accent on left */
margin-bottom: 20px;
padding: 20px;
border-radius: 8px;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
background-color: #fff;
transition: transform 0.2s;
}
.article-card:hover {
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
.article-title {
color: var(--color-dark-bg);
font-size: 1.3rem;
margin-bottom: 10px;
font-weight: 600;
}
.article-meta span {
font-size: 0.9rem;
color: var(--color-text-muted);
margin-right: 15px;
}
</style>
</head>
<body>

<header class="app-header">
<div class="logo-section">
<img src="https://placehold.co/40x40/007bff/ffffff?text=AI" alt="SuperPrompter Logo" class="app-logo">
<h1 class="header-title">SuperPrompter</h1>
</div>
<nav>
<a href="{{ url_for('landing') }}" class="btn btn-outline-light btn-sm mr-2">Back to Landing Page</a>
<a href="{{ url_for('all_jobs') }}" class="btn btn-outline-light btn-sm mr-2">AI Jobs</a>
</nav>
</header>

<div class="container">
<h1 class="text-center mb-5" style="color: var(--color-dark-bg);">ðŸ“° Latest AI News & Updates</h1>

<form method="GET" action="{{ url_for('all_news') }}" class="mb-4">
    <div class="input-group">
        <input type="text" class="form-control" 
               placeholder="Search news by title or summary..." 
               name="q" 
               value="{{ request.args.get('q', '') }}"
               list="autocomplete-list">
        
        <div class="input-group-append">
            <button class="btn btn-secondary" style="background-color: var(--color-secondary); color: white;" type="submit">Search</button>
        </div>
    </div>
    <datalist id="autocomplete-list"></datalist>
</form>

{% if articles %}
{% for article in articles %}
<div class="article-card">
<h3 class="article-title">
    {% if article.id in blog_id_tracker %}
        <a href="#" 
           data-toggle="modal" 
           data-target="#blogModal" 
           data-title="{{ article.title }}" 
           data-content="{{ article.description }}" 
           onclick="return false;" 
           style="color: var(--color-secondary); text-decoration: none;">
            <i class="fas fa-book-open" style="font-size: 0.9em;"></i> 
            {{ article.title }} 
            <small>(In-App Article)</small>
        </a>
    {% else %}
        <a href="{{ article.source_url }}" target="_blank" style="color: inherit; text-decoration: none;">
            {{ article.title }} <i class="fas fa-external-link-alt" style="font-size: 0.8em;"></i>
        </a>
    {% endif %}
</h3>

<p>{{ article.summary | truncate(200) }}</p>

<div class="article-meta">
<span><i class="fas fa-calendar-alt"></i> Published: {{ article.date_published.strftime('%b %d, %Y') }}</span>
</div>
</div>
{% endfor %}

<div class="d-flex justify-content-center mt-5">
    <nav>
        <ul class="pagination">
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" 
                   href="{{ url_for(request.endpoint, page=pagination.prev_num, q=search_query) if pagination.has_prev else '#' }}">
                   Previous
                </a>
            </li>

            {% for p in pagination.iter_pages() %}
                {% if p %}
                    {% if p == pagination.page %}
                        <li class="page-item active"><a class="page-link" href="#">{{ p }}</a></li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for(request.endpoint, page=p, q=search_query) }}">{{ p }}</a>
                        </li>
                    {% endif %}
                {% else %}
                    <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                {% endif %}
            {% endfor %}

            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" 
                   href="{{ url_for(request.endpoint, page=pagination.next_num, q=search_query) if pagination.has_next else '#' }}">
                   Next
                </a>
            </li>
        </ul>
    </nav>
</div>
{% else %}
<div class="alert alert-info text-center">
    No news articles found.
    {% if request.args.get('q') %}
        Please try a different search term or check back later.
    {% else %}
        No news articles have been added yet. Check back soon!
    {% endif %}
</div>
{% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="modal fade" id="blogModal" tabindex="-1" role="dialog" aria-labelledby="blogModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="blogModalLabel">In-App Article</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h3 id="modal-title" class="mb-4"></h3>
                <div id="modal-content-body" style="white-space: pre-wrap; font-size: 1.1rem;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Target the input with name="q"
        const input = document.querySelector('input[name="q"]');
        const dataList = document.getElementById('autocomplete-list');

        // Set the API endpoint URL for this specific page
        const API_URL = '{{ url_for("news_autocomplete") }}'; 
        
        let typingTimer;
        const doneTypingInterval = 300; // Time in ms (e.g., 0.3 seconds)

        input.addEventListener('keyup', () => {
            clearTimeout(typingTimer);
            if (input.value.length >= 2) { // Trigger only if 2 or more characters are typed
                typingTimer = setTimeout(fetchSuggestions, doneTypingInterval);
            } else {
                dataList.innerHTML = ''; // Clear suggestions if input is too short
            }
        });

        function fetchSuggestions() {
            const query = input.value;
            if (!query) return;

            fetch(API_URL + '?q=' + encodeURIComponent(query))
                .then(response => response.json())
                .then(data => {
                    dataList.innerHTML = ''; // Clear previous suggestions
                    data.forEach(suggestion => {
                        const option = document.createElement('option');
                        option.value = suggestion;
                        dataList.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching autocomplete data:', error));
        }
    });

// --- 2. Blog Modal Logic ---
    // Uses jQuery (loaded above) for Bootstrap Modal functionality
    $('#blogModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Link that triggered the modal
        var title = button.data('title'); 
        var content = button.data('content'); 
        
        var modal = $(this);
        
        // Populate Title
        modal.find('#modal-title').text(title);
        
        // Populate Content (Using text() and pre-wrap CSS for secure display of newline characters)
        // We retrieve the raw text, apply newlines via JS/CSS, ensuring no accidental HTML injection.
        modal.find('#modal-content-body').text(content); 
    });
    
</script>
    
</body>
</html>
