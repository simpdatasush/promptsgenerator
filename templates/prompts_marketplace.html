<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>SuperPrompter - Prompts Marketplace</title>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
   <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}">
   
   <style>
       :root {
    --color-primary: #007bff;     /* Landing Page Blue */
    --color-dark-bg: #343a40;     /* Landing Page Charcoal */
    --color-accent: #C3497C;      /* Keeping Pink ONLY for AI Summary */
    --color-bg-light: #f0f2f5;
    --color-text-dark: #2c3e50;
    --shadow-standard: 0 4px 15px rgba(0, 0, 0, 0.1);
    --radius-standard: 10px;
}

*, *::before, *::after { box-sizing: border-box; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding-top: 100px; /* Unified gap for fixed header */
    background-color: var(--color-bg-light);
    color: var(--color-text-dark);
    line-height: 1.6;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

/* =========================================
   2. UNIFIED HEADER (Stable on all pages)
========================================= */
.app-header {
    background-color: var(--color-dark-bg);
    color: #ffffff;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    width: 100%;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
}

.app-header .logo-section { display: flex; align-items: center; }
.app-header .app-logo { height: 40px; margin-right: 15px; border-radius: 5px; }

.app-header h1.header-title {
            margin: 0;
            font-size: 1.8rem;
            color: #ffffff;
            text-align: left;
        }

.app-header .auth-section { display: flex; align-items: center; }
.app-header .auth-section a {
    color: #ffffff;
    margin-left: 20px;
    text-decoration: none;
    transition: color 0.2s ease;
    white-space: nowrap;
}

.app-header .auth-section a:hover { color: var(--color-primary); }

      * Target the container and the link specifically */
.nav-section a {
    color: #ffffff !important; /* Forces the color to white */
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
}

/* --- Marketplace Brick Layout --- */
.brick-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 50px;
}

.prompt-card {
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    min-height: 280px; /* Adjusted for text space */
    box-shadow: var(--shadow-standard);
    position: relative;
    overflow: hidden;
}

.prompt-card:hover {
    transform: translateY(-5px);
    border-color: var(--color-primary);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

/* --- Prompt Text Content --- */
.prompt-text-area {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 6px;
    font-size: 0.85rem;
    margin: 10px 0;
    border-left: 4px solid var(--color-primary);
    white-space: pre-wrap;
    color: #444;
    max-height: 150px;
    overflow-y: auto;
}

/* --- Premium Lock & Blur Logic --- */
.content-blurred {
    filter: blur(6px); /* Increased blur for better privacy */
    user-select: none;
    pointer-events: none;
    opacity: 0.5;
}

.lock-overlay {
    position: absolute;
    top: 45%; /* Centered over the text area */
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 10;
    width: 80%;
}

.lock-overlay i {
    font-size: 2.5rem;
    color: var(--color-dark-bg);
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* --- Action Buttons --- */
.btn-copy { 
    color: #28a745; 
    cursor: pointer; 
    border: 1px solid transparent; 
    background: none; 
    font-weight: 600; 
    padding: 5px 10px;
    transition: all 0.2s;
}
.btn-copy:hover { background: #e8f5e9; border-radius: 4px; }

.btn-buy { 
    color: var(--color-accent); 
    font-weight: 700; 
    text-decoration: none !important;
    border: 1px solid var(--color-accent);
    padding: 5px 12px;
    border-radius: 4px;
    transition: all 0.2s;
}
.btn-buy:hover { background: var(--color-accent); color: #fff; }

   </style>
</head>
<body>
   <header class="app-header">
        <div class="logo-section">
            <img src="https://placehold.co/40x40/007bff/ffffff?text=AI" alt="SuperPrompter Logo" class="app-logo">
            <h1 class="header-title">SuperPrompter</h1>
       </div>
       <div class="nav-section">
           <a href="/">Home</a>
       </div>
   </header>

   <div class="container">
    <div class="text-center mb-5">
        <h2 class="font-weight-bold">Prompts Marketplace</h2>
        <p class="text-muted">Premium and community prompts to supercharge your AI.</p>
    </div>

    <div class="alphabet-nav d-flex flex-wrap justify-content-center mb-5">
    <button class="letter-btn active" onclick="filterByLetter('ALL', this)">ALL</button>
    {% for char in "ABCDEFGHIJKLMNOPQRSTUVWXYZ" %}
        <button class="letter-btn" onclick="filterByLetter('{{ char }}', this)">{{ char }}</button>
    {% endfor %}
    <button class="letter-btn" onclick="filterByLetter('OTHER', this)">#</button>
</div>

    <div id="dynamic-prompts-container"></div>
        </div>
</div>

       <div class="brick-grid">
    {% if prompts %}
        {% for p in prompts %}
        <div class="brick-card prompt-card" style="height: auto; min-height: 250px;">
            <div class="brick-title d-flex justify-content-between">
                {{ p.title }}
                {% if '[LOCKED]' in p.description %}
                    <i class="fas fa-lock text-warning" title="Premium Prompt"></i>
                {% endif %}
            </div>

            <div class="brick-desc mb-3">
                {% set is_locked = '[LOCKED]' in p.description %}
                <div class="prompt-text-area {% if is_locked %}content-blurred{% endif %}" id="prompt-text-{{ p.id }}">
                    {% if is_locked %}
                        This is a highly useful premium prompt. Please support the platform to unlock the full content.
                    {% else %}
                        {# Strip all tags: [PROMPT][CAT][VIS] Content #}
                        {{ p.description.split(']')[-1].strip() }}
                    {% endif %}
                </div>
            </div>

            <div class="mt-auto pt-3 border-top d-flex justify-content-between align-items-center">
                {% if is_locked %}
                    <a href="{{ url_for('donate') }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-shopping-cart"></i> Buy / Unlock
                    </a>
                {% else %}
                    <button class="btn btn-sm btn-outline-success" onclick="copyToClipboard('prompt-text-{{ p.id }}')">
                        <i class="fas fa-copy"></i> Copy Prompt
                    </button>
                {% endif %}
                
                <a href="{{ url_for('donate') }}" class="text-muted small">
                    <i class="fas fa-heart text-danger"></i> Donate
                </a>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12 text-center py-5">
            <i class="fas fa-magic fa-3x text-light mb-3"></i>
            <p class="text-muted">The marketplace is currently empty. Check back soon!</p>
        </div>
    {% endif %}
</div>

   <footer class="footer">
       <div class="footer-content">
           &copy; 2026 Prompts Marketplace &nbsp; | &nbsp; 
           <a href="mailto:info@promptsgenerator.ai">Contact Support</a>
       </div>
   </footer>

<script>

<script>
// 3. Load Python data into JS Array
const allPrompts = [
    {% for p in prompts %}
    {
        id: "{{ p.id }}",
        title: "{{ p.title }}",
        // Parsing [PROMPT][CATEGORY][VISIBILITY] Content
        category: {{ p.description | tojson }}.match(/\[PROMPT\]\[(.*?)\]/) ? {{ p.description | tojson }}.match(/\[PROMPT\]\[(.*?)\]/)[1] : "General",
        visibility: {{ p.description | tojson }}.match(/\[PROMPT\]\[.*?\]\[(.*?)\]/) ? {{ p.description | tojson }}.match(/\[PROMPT\]\[.*?\]\[(.*?)\]/)[1] : "OPEN",
        content: {{ p.description | tojson }}.replace(/\[PROMPT\]\[.*?\]\[.*?\]/, "").trim()
    },
    {% endfor %}
];

function filterByLetter(letter, element) {
    // UI: Update active state for buttons
    document.querySelectorAll('.letter-btn').forEach(btn => btn.classList.remove('active'));
    if (element) {
        element.classList.add('active');
    } else {
        // Default to 'ALL' or 'A' button if no element passed
        const defaultBtn = [...document.querySelectorAll('.letter-btn')].find(b => b.innerText === letter);
        if (defaultBtn) defaultBtn.classList.add('active');
    }

    const container = document.getElementById('dynamic-prompts-container');
    container.innerHTML = "";

    // FILTER LOGIC
    let matches;
    if (letter === 'ALL') {
        matches = allPrompts;
    } else if (letter === 'OTHER') {
        // Matches titles NOT starting with A-Z
        matches = allPrompts.filter(p => !/^[a-zA-Z]/.test(p.title.trim()));
    } else {
        // Matches specific starting letter
        matches = allPrompts.filter(p => p.title.trim().toUpperCase().startsWith(letter));
    }

    if (matches.length === 0) {
        container.innerHTML = `<div class="text-center py-5 text-muted">
            <i class="fas fa-search fa-3x mb-3"></i><br>
            No prompts found for "${letter}"
        </div>`;
        return;
    }

    // GROUPING BY CATEGORY
    const grouped = matches.reduce((acc, p) => {
        acc[p.category] = acc[p.category] || [];
        acc[p.category].push(p);
        return acc;
    }, {});

    // RENDERING
    for (const [category, prompts] of Object.entries(grouped)) {
        let section = `<h3 class="category-header">${category}</h3><div class="brick-grid">`;
        
        prompts.forEach(p => {
            const isLocked = p.visibility === "LOCKED";
            
            section += `
                <div class="prompt-card">
                    <div class="brick-title d-flex justify-content-between">
                        ${p.title}
                        ${isLocked ? '<i class="fas fa-lock text-warning small"></i>' : ''}
                    </div>
                    
                    <div class="prompt-text-area ${isLocked ? 'content-blurred' : ''}" id="prompt-${p.id}">
                        ${isLocked ? "This is a premium prompt. Access the content by supporting our community." : p.content}
                    </div>

                    ${isLocked ? `
                        <div class="lock-overlay">
                            <i class="fas fa-lock fa-2x text-muted mb-2"></i><br>
                            <a href="/donate" class="btn btn-sm btn-primary">Unlock Prompt</a>
                        </div>
                    ` : ''}

                    <div class="mt-auto pt-2 d-flex justify-content-between align-items-center">
                        ${!isLocked ? `
                            <button class="btn-copy" onclick="copyToClipboard('${p.id}')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        ` : `
                            <a href="/donate" class="btn-buy"><i class="fas fa-shopping-cart"></i> Get Access</a>
                        `}
                        <span class="badge badge-light border text-muted">${p.category}</span>
                    </div>
                </div>`;
        });
        
        section += `</div>`;
        container.insertAdjacentHTML('beforeend', section);
    }
}

/**
 * Enhanced Copy Function
 * Finds the actual data from the allPrompts array to avoid copying "Blurred" text
 */
function copyToClipboard(id) {
    const promptData = allPrompts.find(p => p.id == id);
    if (promptData && promptData.visibility !== "LOCKED") {
        navigator.clipboard.writeText(promptData.content).then(() => {
            // Optional: Change button text temporarily for feedback
            const btn = window.event.target.closest('.btn-copy');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
        });
    }
}

// Set default view to 'ALL' on load
document.addEventListener("DOMContentLoaded", () => {
    filterByLetter('ALL');
});
</script>


</body>
</html>
